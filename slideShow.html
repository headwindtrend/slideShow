<html>
<head>
<title>Simple Slideshow</title>
<style>
	body, html {
		margin: 0;
		padding: 0;
		height: 100%;
		overflow: hidden;
	}
	#slideshow {
		width: 100%;
		height: 100%;
		display: flex;
		justify-content: center;
		align-items: center;
		background-color: #000;
	}
	#slide {
		max-width: 100%;
		max-height: 100%;
		object-fit: contain;
	}
	#curIndex {
		top: 10px;
	}
	#curIndex, #excludeImage {
		position: fixed;
		right: 10px;
		background-color: rgba(0, 0, 0, 0.5);
		padding: 5px 10px;
		border-radius: 5px;
		color: white;
		font-family: Arial, sans-serif;
		cursor: pointer;
	}
	.red-border {
		border: 1px solid red;
	}
	#excludeImage {
		bottom: 10px;
	}
</style>
</head>
<body>
<div id="slideshow">
	<img id="slide" src="" alt="Slideshow Image">
</div>
<div id="curIndex" class="setting" onclick="if (poolSize() > 2) {this.classList.toggle('red-border');if (this.classList.contains('red-border')) showNextSlide();}" oncontextmenu="this.style.display = 'none'; return false"></div>
<div id="excludeImage" class="setting" onclick="removeCurImage(); if (poolSize()) {showPrevSlide(); showNextSlide()} else {reset()}">Exclude</div>
<div id="loaders" style="position: fixed; top: 10px; left: 10px;" onclick="reset(); if (event.target.id.toLowerCase().indexOf('proxy')===-1) document.getElementById(event.target.id).addEventListener('change', handleImage, false);">
	<label id="proxyFolderLoader" class="setting" for="folderLoader" style="display: block; cursor: pointer; color: white;">Choose Folder</label>
	<input type="file" id="folderLoader" class="setting" name="imageLoader[]" webkitdirectory directory multiple accept="image/*" style="display: none;"/>
	<!--button id="folderLoaderProxy" class="setting" onclick="document.getElementById(this.id.slice(0, -5)).click()">Choose Folder</button-->
	<br>
	<label id="proxyFilesLoader" class="setting" for="filesLoader" style="display: block; cursor: pointer; color: white;">Choose Files</label>
	<input type="file" id="filesLoader" class="setting" name="imageLoader[]" multiple accept="image/*" style="display: none;"/>
	<!--button id="filesLoaderProxy" class="setting" onclick="document.getElementById(this.id.slice(0, -5)).click()">Choose Files</button-->
</div>

<script>
window.onload = function() {
	const foundProxy = document.querySelector(".setting[id*='roxy']");
	if (foundProxy) {
		document.getElementById('folderLoader').style.display = 'none';
		document.getElementById('filesLoader').style.display = 'none';
	}else{
		document.getElementById('folderLoader').style.display = 'block';
		document.getElementById('filesLoader').style.display = 'block';
	}
};

const rHist = [], images = [];
let ranIndex = currentIndex = 0;
let isPlaying = true;
const intervalIds = [];

const slideElement = document.getElementById('slide');

function handleImage(e) {
	let files = e.target.files;
	for (let i = 0; i < files.length; i++) {
		let file = files[i];
		if (!file.type.startsWith('image/')) continue; // Skip non-image files
		let url = URL.createObjectURL(file);
		images.push(url);
	}
	if (images.length) { // If any images are loaded
		currentIndex = images.length - 1;
		startSlideshow();
	}
	document.getElementById(e.target.id).removeEventListener('change', handleImage, false);
}

function showNextSlide() {
	if (curIndex.classList.contains("red-border")) {
		// if ranIndex is currently pointing at the last array member of rHist, generate a random index out of the images pool
		if (!rHist.length || ranIndex === rHist.length - 1){
			let nextIndex = currentIndex;
			while (nextIndex === currentIndex) {
				nextIndex = Math.floor(Math.random()*images.length);
			}currentIndex = nextIndex;	// updates currentIndex
			rHist.push(currentIndex);	// stacks the newly generated index
			if (rHist.length > 1000) rHist.shift();	// impose a max cap
			ranIndex = rHist.length - 1;	// updates ranIndex
		}else{
			ranIndex = (ranIndex + 1) % rHist.length;	// updates ranIndex
			currentIndex = rHist[ranIndex];	// updates currentIndex
		}
	}else{
		currentIndex = (currentIndex + 1) % images.length;
	}
	slideElement.src = images[currentIndex];
	curIndex.innerText = currentIndex + 1;
}

function showPrevSlide() {
	if (curIndex.classList.contains("red-border")) {
		ranIndex = (ranIndex - 1 + rHist.length) % rHist.length;	// updates ranIndex
		currentIndex = rHist[ranIndex];	// updates currentIndex
	}else{
		currentIndex = (currentIndex - 1 + images.length) % images.length;
	}
	slideElement.src = images[currentIndex];
	curIndex.innerText = currentIndex + 1;
}

function togglePlayPause() {
	isPlaying = !isPlaying;
	if (isPlaying) {
		if (images.length) startSlideshow();
	} else {
		stopSlideshow();
	}
}

function startSlideshow() {
	if (!isPlaying) isPlaying = true;
	showNextSlide();
	const intervalId = setInterval(showNextSlide, 5000);
	if (!intervalIds.includes(intervalId)) intervalIds.push(intervalId);
	loaders.style.display = "none";
	excludeImage.style.display = "none";
}

function stopSlideshow() {
	if (isPlaying) isPlaying = false;
	intervalIds.forEach(intervalId => clearInterval(intervalId));
	loaders.style.display = "block";
	curIndex.style.display = "block";
	excludeImage.style.display = "block";
}

function reset() {
	stopSlideshow();
	rHist.length = images.length = 0;
	ranIndex = currentIndex = 0;
	slideElement.src = "";
	curIndex.innerText = 0;
}

function poolSize() {
	return images.length
}

function removeCurImage() {
	rHist.length = ranIndex = 0;
	if (curIndex.classList.contains("red-border")) curIndex.classList.toggle('red-border');
	images.splice(currentIndex, 1);
}

document.addEventListener('keydown', (event) => {
	if (event.code === 'Space') {
		if (!event.target.closest(".setting")) togglePlayPause();
	} else if (event.code === 'ArrowRight') {
		if (images.length) showNextSlide();
	} else if (event.code === 'ArrowLeft') {
		if (images.length) showPrevSlide();
	}
});

document.addEventListener('click', (event) => {
	if (!event.target.closest(".setting")) togglePlayPause();
});

</script>
</body>
</html>
